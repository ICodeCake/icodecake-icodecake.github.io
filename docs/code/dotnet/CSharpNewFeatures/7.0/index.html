<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.51">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/images/logo.png"><title>CSharp 7.0 新特性 | Code Cake</title><meta name="description" content="代码分享">
    <link rel="modulepreload" href="/assets/app.d8de21cf.js"><link rel="modulepreload" href="/assets/index.html.cd10fa04.js"><link rel="modulepreload" href="/assets/index.html.e036732a.js"><link rel="prefetch" href="/assets/index.html.b5b50aed.js"><link rel="prefetch" href="/assets/index.html.82c10bf5.js"><link rel="prefetch" href="/assets/markdown.html.373131ab.js"><link rel="prefetch" href="/assets/index.html.0f8400b2.js"><link rel="prefetch" href="/assets/index.html.5187c5a6.js"><link rel="prefetch" href="/assets/index.html.d5708d20.js"><link rel="prefetch" href="/assets/index.html.e801a3c2.js"><link rel="prefetch" href="/assets/index.html.093bbf26.js"><link rel="prefetch" href="/assets/index.html.7133a7ec.js"><link rel="prefetch" href="/assets/CodeReadability.html.e0c8ecb4.js"><link rel="prefetch" href="/assets/CodeReview.html.148be5a3.js"><link rel="prefetch" href="/assets/CSharpCodingStyle.html.db2bbb9b.js"><link rel="prefetch" href="/assets/index.html.10e573d6.js"><link rel="prefetch" href="/assets/UnitTesting.html.448518f1.js"><link rel="prefetch" href="/assets/index.html.7558b781.js"><link rel="prefetch" href="/assets/index.html.7730f91b.js"><link rel="prefetch" href="/assets/index.html.197fa484.js"><link rel="prefetch" href="/assets/index.html.200a2147.js"><link rel="prefetch" href="/assets/index.html.e0b02fac.js"><link rel="prefetch" href="/assets/index.html.6a6c9c82.js"><link rel="prefetch" href="/assets/index.html.c828d055.js"><link rel="prefetch" href="/assets/index.html.af464f70.js"><link rel="prefetch" href="/assets/index.html.42e40658.js"><link rel="prefetch" href="/assets/index.html.8870f8ee.js"><link rel="prefetch" href="/assets/index.html.0c10a718.js"><link rel="prefetch" href="/assets/index.html.033b940a.js"><link rel="prefetch" href="/assets/index.html.1cf9b97a.js"><link rel="prefetch" href="/assets/index.html.f33bc4ff.js"><link rel="prefetch" href="/assets/Built-inTypesAndMethods.html.6a6bb314.js"><link rel="prefetch" href="/assets/index.html.d00e9e45.js"><link rel="prefetch" href="/assets/index.html.7579bb0e.js"><link rel="prefetch" href="/assets/index.html.37d3418a.js"><link rel="prefetch" href="/assets/index.html.6acba1cd.js"><link rel="prefetch" href="/assets/index.html.10f6513e.js"><link rel="prefetch" href="/assets/index.html.c1838371.js"><link rel="prefetch" href="/assets/index.html.94741f0e.js"><link rel="prefetch" href="/assets/index.html.19583f34.js"><link rel="prefetch" href="/assets/index.html.1af6fd58.js"><link rel="prefetch" href="/assets/index.html.c0ffc9c0.js"><link rel="prefetch" href="/assets/index.html.0cd4c1be.js"><link rel="prefetch" href="/assets/index.html.ae3ec48d.js"><link rel="prefetch" href="/assets/index.html.c65749d4.js"><link rel="prefetch" href="/assets/index.html.8fddda95.js"><link rel="prefetch" href="/assets/index.html.2a965062.js"><link rel="prefetch" href="/assets/index.html.d8120c31.js"><link rel="prefetch" href="/assets/index.html.aa4d6c47.js"><link rel="prefetch" href="/assets/index.html.345f180d.js"><link rel="prefetch" href="/assets/index.html.6ba2983a.js"><link rel="prefetch" href="/assets/index.html.e40438d2.js"><link rel="prefetch" href="/assets/index.html.2efe1c06.js"><link rel="prefetch" href="/assets/index.html.6816dcdc.js"><link rel="prefetch" href="/assets/index.html.cacc9c2e.js"><link rel="prefetch" href="/assets/index.html.b29383df.js"><link rel="prefetch" href="/assets/404.html.d8035c30.js"><link rel="prefetch" href="/assets/index.html.642869eb.js"><link rel="prefetch" href="/assets/index.html.bb10befb.js"><link rel="prefetch" href="/assets/markdown.html.ce0fb8ec.js"><link rel="prefetch" href="/assets/index.html.6d8c3972.js"><link rel="prefetch" href="/assets/index.html.80a47ea8.js"><link rel="prefetch" href="/assets/index.html.9e50e8e8.js"><link rel="prefetch" href="/assets/index.html.a26a56cd.js"><link rel="prefetch" href="/assets/index.html.37a90856.js"><link rel="prefetch" href="/assets/index.html.463645ab.js"><link rel="prefetch" href="/assets/CodeReadability.html.47e4cf29.js"><link rel="prefetch" href="/assets/CodeReview.html.9a4419bb.js"><link rel="prefetch" href="/assets/CSharpCodingStyle.html.4475a9cb.js"><link rel="prefetch" href="/assets/index.html.82f122fe.js"><link rel="prefetch" href="/assets/UnitTesting.html.db04bdaf.js"><link rel="prefetch" href="/assets/index.html.cec28eba.js"><link rel="prefetch" href="/assets/index.html.fe6063eb.js"><link rel="prefetch" href="/assets/index.html.bba82fc8.js"><link rel="prefetch" href="/assets/index.html.15996377.js"><link rel="prefetch" href="/assets/index.html.28ded740.js"><link rel="prefetch" href="/assets/index.html.7dee486d.js"><link rel="prefetch" href="/assets/index.html.cd9b40f4.js"><link rel="prefetch" href="/assets/index.html.ce16acfe.js"><link rel="prefetch" href="/assets/index.html.9863f8b1.js"><link rel="prefetch" href="/assets/index.html.e1fc63b7.js"><link rel="prefetch" href="/assets/index.html.5a67da43.js"><link rel="prefetch" href="/assets/index.html.b2b70b5a.js"><link rel="prefetch" href="/assets/index.html.4bc61df9.js"><link rel="prefetch" href="/assets/index.html.5a1cd3d8.js"><link rel="prefetch" href="/assets/Built-inTypesAndMethods.html.731e55c3.js"><link rel="prefetch" href="/assets/index.html.63b4f3d6.js"><link rel="prefetch" href="/assets/index.html.47de037f.js"><link rel="prefetch" href="/assets/index.html.c5e3a573.js"><link rel="prefetch" href="/assets/index.html.9d3e6fb4.js"><link rel="prefetch" href="/assets/index.html.9a55eb9e.js"><link rel="prefetch" href="/assets/index.html.502fe241.js"><link rel="prefetch" href="/assets/index.html.32e42d30.js"><link rel="prefetch" href="/assets/index.html.fb246f03.js"><link rel="prefetch" href="/assets/index.html.0e85ea97.js"><link rel="prefetch" href="/assets/index.html.e631137d.js"><link rel="prefetch" href="/assets/index.html.91f8a998.js"><link rel="prefetch" href="/assets/index.html.dbf0efed.js"><link rel="prefetch" href="/assets/index.html.5d5985d2.js"><link rel="prefetch" href="/assets/index.html.9408a9bd.js"><link rel="prefetch" href="/assets/index.html.ce1898d5.js"><link rel="prefetch" href="/assets/index.html.7d09f44b.js"><link rel="prefetch" href="/assets/index.html.c9e7b11f.js"><link rel="prefetch" href="/assets/index.html.89f65722.js"><link rel="prefetch" href="/assets/index.html.ec39eff1.js"><link rel="prefetch" href="/assets/index.html.cb08b3bc.js"><link rel="prefetch" href="/assets/index.html.12d7f267.js"><link rel="prefetch" href="/assets/index.html.4cd66e49.js"><link rel="prefetch" href="/assets/index.html.743c7b82.js"><link rel="prefetch" href="/assets/index.html.04756b82.js"><link rel="prefetch" href="/assets/404.html.75b05b11.js">
    <link rel="stylesheet" href="/assets/style.f35a7668.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><img class="logo" src="/images/logo.png" alt="Code Cake"><span class="site-name can-hide">Code Cake</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/code/dotnet/" class="router-link-active" aria-label=".NET"><!--[--><!--]--> .NET <!--[--><!--]--></a></div><div class="navbar-item"><a href="/code/web/" class="" aria-label="WEB"><!--[--><!--]--> WEB <!--[--><!--]--></a></div><div class="navbar-item"><a href="/code/db/" class="" aria-label="DB"><!--[--><!--]--> DB <!--[--><!--]--></a></div><div class="navbar-item"><a href="/code/test/" class="" aria-label="Test"><!--[--><!--]--> Test <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Sample"><span class="title">Sample</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Sample"><span class="title">Sample</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Markdown</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/sample/markdown.html" class="" aria-label="Markdown 语法"><!--[--><!--]--> Markdown 语法 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/icodecake/icodecake.github.io" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" placeholder="搜索" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/code/dotnet/" class="router-link-active" aria-label=".NET"><!--[--><!--]--> .NET <!--[--><!--]--></a></div><div class="navbar-item"><a href="/code/web/" class="" aria-label="WEB"><!--[--><!--]--> WEB <!--[--><!--]--></a></div><div class="navbar-item"><a href="/code/db/" class="" aria-label="DB"><!--[--><!--]--> DB <!--[--><!--]--></a></div><div class="navbar-item"><a href="/code/test/" class="" aria-label="Test"><!--[--><!--]--> Test <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Sample"><span class="title">Sample</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Sample"><span class="title">Sample</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Markdown</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/sample/markdown.html" class="" aria-label="Markdown 语法"><!--[--><!--]--> Markdown 语法 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/icodecake/icodecake.github.io" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">WPF <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/code/dotnet/WpfUILayout" class="sidebar-item" aria-label="WPF UI Layout"><!--[--><!--]--> WPF UI Layout <!--[--><!--]--></a><!----></li><li><a href="/code/dotnet/XAMLBinding" class="sidebar-item" aria-label="XAML Binding"><!--[--><!--]--> XAML Binding <!--[--><!--]--></a><!----></li><li><a href="/code/dotnet/Language" class="sidebar-item" aria-label="中英文切换"><!--[--><!--]--> 中英文切换 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading active">C# <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><p tabindex="0" class="sidebar-item active">新特性 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/code/dotnet/CSharpNewFeatures/7.0/" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="7.0"><!--[--><!--]--> 7.0 <!--[--><!--]--></a><!----></li><li><a href="/code/dotnet/CSharpNewFeatures/8.0/" class="sidebar-item" aria-label="8.0"><!--[--><!--]--> 8.0 <!--[--><!--]--></a><!----></li><li><a href="/code/dotnet/CSharpNewFeatures/9.0/" class="sidebar-item" aria-label="9.0"><!--[--><!--]--> 9.0 <!--[--><!--]--></a><!----></li><li><a href="/code/dotnet/CSharpNewFeatures/10.0/" class="sidebar-item" aria-label="10.0"><!--[--><!--]--> 10.0 <!--[--><!--]--></a><!----></li><li><a href="/code/dotnet/CSharpNewFeatures/11.0/" class="sidebar-item" aria-label="11.0"><!--[--><!--]--> 11.0 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item">多线程 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/code/dotnet/Multithreading/BackgroundWorker/" class="sidebar-item" aria-label="BackgroundWorker"><!--[--><!--]--> BackgroundWorker <!--[--><!--]--></a><!----></li><li><a href="/code/dotnet/Multithreading/ThreadOrTask/" class="sidebar-item" aria-label="Thread Or Task"><!--[--><!--]--> Thread Or Task <!--[--><!--]--></a><!----></li><li><a href="/code/dotnet/Multithreading/Parallel/" class="sidebar-item" aria-label="Parallel"><!--[--><!--]--> Parallel <!--[--><!--]--></a><!----></li><li><a href="/code/dotnet/Multithreading/AsyncAndAwait/" class="sidebar-item" aria-label="Async Await"><!--[--><!--]--> Async Await <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/code/dotnet/Log4Net/" class="sidebar-item" aria-label="Log4Net"><!--[--><!--]--> Log4Net <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Other <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/code/dotnet/InvalidFileName" class="sidebar-item" aria-label="Win10 aux,com1~com9,prn,con,nul文件命名无效"><!--[--><!--]--> Win10 aux,com1~com9,prn,con,nul文件命名无效 <!--[--><!--]--></a><!----></li><li><a href="/code/dotnet/matlab" class="sidebar-item" aria-label="C#调用Matlab函数"><!--[--><!--]--> C#调用Matlab函数 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="csharp-7-0-新特性" tabindex="-1"><a class="header-anchor" href="#csharp-7-0-新特性" aria-hidden="true">#</a> CSharp 7.0 新特性</h1><h2 id="新特性" tabindex="-1"><a class="header-anchor" href="#新特性" aria-hidden="true">#</a> 新特性</h2><h3 id="_1-out-变量-out-variables" tabindex="-1"><a class="header-anchor" href="#_1-out-变量-out-variables" aria-hidden="true">#</a> 1. out 变量（out variables）</h3><p>以前我们使用 out 变量必须在使用前进行声明，C# 7.0 给我们提供了一种更简洁的语法 “使用时进行内联声明” 。如下所示：</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> input <span class="token operator">=</span> <span class="token function">ReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">.</span><span class="token function">TryParse</span><span class="token punctuation">(</span>input<span class="token punctuation">,</span> <span class="token keyword">out</span> <span class="token class-name"><span class="token keyword">var</span></span> result<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
      <span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;您输入的数字是：{0}&quot;</span><span class="token punctuation">,</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">else</span>
  <span class="token punctuation">{</span>
      <span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;无法解析输入...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面代码编译后：</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">int</span></span> num<span class="token punctuation">;</span>
  <span class="token class-name"><span class="token keyword">string</span></span> s <span class="token operator">=</span> Console<span class="token punctuation">.</span><span class="token function">ReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">.</span><span class="token function">TryParse</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token keyword">out</span> num<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;您输入的数字是：{0}&quot;</span><span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">else</span>
  <span class="token punctuation">{</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;无法解析输入...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>原理解析：所谓的 “内联声明” 编译后就是以前的原始写法，只是现在由编译器来完成。</p><p>备注：在进行内联声明时，即可直接写明变量的类型也可以写隐式类型，因为 out 关键字修饰的一定是局部变量。</p><h3 id="_2-元组-tuples" tabindex="-1"><a class="header-anchor" href="#_2-元组-tuples" aria-hidden="true">#</a> 2. 元组（Tuples）</h3><p>值元组也是一种数据结构，用于表示特定数量和元素序列，但是是和元组类不一样的，主要区别如下： 值元组是结构，是值类型，不是类，而元组（Tuple）是类，引用类型； 值元组元素是可变的，不是只读的，也就是说可以改变值元组中的元素值； 值元组的数据成员是字段不是属性。 值元组的具体使用如下：</p><ol><li>如何创建值元组 和元组类一样，.Net Framework 值元组也只支持 1 到 7 个元组元素，如果有 8 个元素或者更多，需要使用值元组的嵌套和 Rest 属性去实现。另外 ValueTuple 类可以提供创造值元组对象的静态方法。 利用构造函数创建元组：</li></ol><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> testTuple6 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ValueTuple<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;Item 1: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">testTuple6<span class="token punctuation">.</span>Item1</span><span class="token punctuation">}</span></span><span class="token string">, Item 6: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">testTuple6<span class="token punctuation">.</span>Item6</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>利用 Tuple 静态方法构建元组，最多支持八个元素：</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> testTuple8 <span class="token operator">=</span> ValueTuple<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Create</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;Item 1: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">testTuple8<span class="token punctuation">.</span>Item1</span><span class="token punctuation">}</span></span><span class="token string">, Item 8: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">testTuple8<span class="token punctuation">.</span>Rest<span class="token punctuation">.</span>Item1</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>注意这里构建出来的 Tuple 类型其实是 <code>Tuple&lt;int, int, int, int, int, int, int, Tuple&lt;int&gt;&gt;</code>，因此 testTuple8.Rest 取到的数据类型是 <code>Tuple&lt;int&gt;</code>，因此要想获取准确值需要取 Item1 属性。</p><p>优化区别：当构造出超过 7 个元素以上的值元组后，可以使用接下来的 ItemX 进行访问嵌套元组中的值，对于上面的例子，要访问第十个元素，既可以通过 testTuple10.Rest.Item3 访问，也可以通过 testTuple10.Item10 来访问。</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> testTuple10 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ValueTuple<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> ValueTuple<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ValueTuple<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;Item 10: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">testTuple10<span class="token punctuation">.</span>Rest<span class="token punctuation">.</span>Item3</span><span class="token punctuation">}</span></span><span class="token string">, Item 10: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">testTuple10<span class="token punctuation">.</span>Item10</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>表示一组数据 如下创建一个值元组表示一个学生的三个信息：名字、年龄和身高，而不用单独额外创建一个类。</li></ol><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> studentInfo <span class="token operator">=</span> ValueTuple<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Create</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">uint</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&quot;Bob&quot;</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">175</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;Student Information: Name [</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">studentInfo<span class="token punctuation">.</span>Item1</span><span class="token punctuation">}</span></span><span class="token string">], Age [</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">studentInfo<span class="token punctuation">.</span>Item2</span><span class="token punctuation">}</span></span><span class="token string">], Height [</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">studentInfo<span class="token punctuation">.</span>Item3</span><span class="token punctuation">}</span></span><span class="token string">]&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>从方法返回多个值 值元组也可以在函数定义中代替 out 参数返回多个值。</li></ol><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">static</span> <span class="token return-type class-name">ValueTuple<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">uint</span><span class="token punctuation">&gt;</span></span> <span class="token function">GetStudentInfo</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ValueTuple <span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">uint</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;Bob&quot;</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">175</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">RunTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> studentInfo <span class="token operator">=</span> <span class="token function">GetStudentInfo</span><span class="token punctuation">(</span><span class="token string">&quot;Bob&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;Student Information: Name [</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">studentInfo<span class="token punctuation">.</span>Item1</span><span class="token punctuation">}</span></span><span class="token string">], Age [</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">studentInfo<span class="token punctuation">.</span>Item2</span><span class="token punctuation">}</span></span><span class="token string">], Height [</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">studentInfo<span class="token punctuation">.</span>Item3</span><span class="token punctuation">}</span></span><span class="token string">]&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>优化区别：返回值可以不明显指定 ValueTuple，使用新语法(,,)代替，如(string, int, uint)：</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">static</span> <span class="token return-type class-name"><span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">uint</span><span class="token punctuation">)</span></span> <span class="token function">GetStudentInfo1</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token string">&quot;Bob&quot;</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">175</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">RunTest1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> studentInfo <span class="token operator">=</span> <span class="token function">GetStudentInfo1</span><span class="token punctuation">(</span><span class="token string">&quot;Bob&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;Student Information: Name [</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">studentInfo<span class="token punctuation">.</span>Item1</span><span class="token punctuation">}</span></span><span class="token string">], Age [</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">studentInfo<span class="token punctuation">.</span>Item2</span><span class="token punctuation">}</span></span><span class="token string">], Height [</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">studentInfo<span class="token punctuation">.</span>Item3</span><span class="token punctuation">}</span></span><span class="token string">]&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>返回值可以指定元素名字，方便理解记忆赋值和访问：</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">static</span> <span class="token return-type class-name"><span class="token punctuation">(</span><span class="token keyword">string</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> age<span class="token punctuation">,</span> <span class="token keyword">uint</span> height<span class="token punctuation">)</span></span> <span class="token function">GetStudentInfo1</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token string">&quot;Bob&quot;</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">175</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">RunTest1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> studentInfo <span class="token operator">=</span> <span class="token function">GetStudentInfo1</span><span class="token punctuation">(</span><span class="token string">&quot;Bob&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;Student Information: Name [</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">studentInfo<span class="token punctuation">.</span>name</span><span class="token punctuation">}</span></span><span class="token string">], Age [</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">studentInfo<span class="token punctuation">.</span>age</span><span class="token punctuation">}</span></span><span class="token string">], Height [</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">studentInfo<span class="token punctuation">.</span>height</span><span class="token punctuation">}</span></span><span class="token string">]&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li>用于单参数方法的多值传递 当函数参数仅是一个 Object 类型时，可以使用值元组实现传递多个值。</li></ol><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">WriteStudentInfo</span><span class="token punctuation">(</span><span class="token class-name">Object</span> student<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> studentInfo <span class="token operator">=</span> <span class="token punctuation">(</span>ValueTuple<span class="token operator">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">uint</span><span class="token operator">&gt;</span><span class="token punctuation">)</span>student<span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;Student Information: Name [</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">studentInfo<span class="token punctuation">.</span>Item1</span><span class="token punctuation">}</span></span><span class="token string">], Age [</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">studentInfo<span class="token punctuation">.</span>Item2</span><span class="token punctuation">}</span></span><span class="token string">], Height [</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">studentInfo<span class="token punctuation">.</span>Item3</span><span class="token punctuation">}</span></span><span class="token string">]&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">RunTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>ParameterizedThreadStart</span><span class="token punctuation">(</span>WriteStudentInfo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    t<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">ValueTuple<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">uint</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;Bob&quot;</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">175</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span>IsAlive<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Thread<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="5"><li>解构 ValueTuple 可以通过 var (x, y)或者(var x, var y)来解析值元组元素构造局部变量，同时可以使用符号”_”来忽略不需要的元素。</li></ol><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">static</span> <span class="token return-type class-name"><span class="token punctuation">(</span><span class="token keyword">string</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> age<span class="token punctuation">,</span> <span class="token keyword">uint</span> height<span class="token punctuation">)</span></span> <span class="token function">GetStudentInfo1</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token string">&quot;Bob&quot;</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">175</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">RunTest1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">var</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> height<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">GetStudentInfo1</span><span class="token punctuation">(</span><span class="token string">&quot;Bob&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;Student Information: Name [</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">name</span><span class="token punctuation">}</span></span><span class="token string">], Age [</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">age</span><span class="token punctuation">}</span></span><span class="token string">], Height [</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">height</span><span class="token punctuation">}</span></span><span class="token string">]&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> name1<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">var</span></span> age1<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">var</span></span> height1<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">GetStudentInfo1</span><span class="token punctuation">(</span><span class="token string">&quot;Bob&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;Student Information: Name [</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">name1</span><span class="token punctuation">}</span></span><span class="token string">], Age [</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">age1</span><span class="token punctuation">}</span></span><span class="token string">], Height [</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">height1</span><span class="token punctuation">}</span></span><span class="token string">]&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> <span class="token punctuation">(</span>_<span class="token punctuation">,</span> age2<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">GetStudentInfo1</span><span class="token punctuation">(</span><span class="token string">&quot;Bob&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;Student Information: Age [</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">age2</span><span class="token punctuation">}</span></span><span class="token string">]&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>由上所述，ValueTuple 使 C#变得更简单易用。较 Tuple 相比主要好处如下：</p><p>ValueTuple 支持函数返回值新语法”(,,)”，使代码更简单； 能够给元素命名，方便使用和记忆，这里需要注意虽然命名了，但是实际上 value tuple 没有定义这样名字的属性或者字段，真正的名字仍然是 ItemX，所有的元素名字都只是设计和编译时用的，不是运行时用的（因此注意对该类型的序列化和反序列化操作）； 可以使用解构方法更方便地使用部分或全部元组的元素； 值元组是值类型，使用起来比引用类型的元组效率高，并且值元组是有比较方法的，可以用于比较是否相等</p><h3 id="_3-模式匹配-pattern-matching" tabindex="-1"><a class="header-anchor" href="#_3-模式匹配-pattern-matching" aria-hidden="true">#</a> 3. 模式匹配（Pattern matching）</h3><p>3.1 is 表达式（is expressions），如：</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">GetSum</span><span class="token punctuation">(</span><span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span><span class="token keyword">object</span><span class="token punctuation">&gt;</span></span> values<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
      <span class="token class-name"><span class="token keyword">var</span></span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>values <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">return</span> sum<span class="token punctuation">;</span>

      <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> item <span class="token keyword">in</span> values<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>item <span class="token keyword">is</span> <span class="token class-name"><span class="token keyword">short</span></span><span class="token punctuation">)</span>     <span class="token comment">// C# 7 之前的 is expressions</span>
          <span class="token punctuation">{</span>
              sum <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span>item<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>item <span class="token keyword">is</span> <span class="token class-name"><span class="token keyword">int</span></span> val<span class="token punctuation">)</span>  <span class="token comment">// C# 7 的 is expressions</span>
          <span class="token punctuation">{</span>
              sum <span class="token operator">+=</span> val<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>item <span class="token keyword">is</span> <span class="token class-name"><span class="token keyword">string</span></span> str <span class="token operator">&amp;&amp;</span> <span class="token keyword">int</span><span class="token punctuation">.</span><span class="token function">TryParse</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> <span class="token keyword">out</span> <span class="token class-name"><span class="token keyword">var</span></span> result<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// is expressions 和 out variables 结合使用</span>
          <span class="token punctuation">{</span>
              sum <span class="token operator">+=</span> result<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>item <span class="token keyword">is</span> <span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span><span class="token keyword">object</span><span class="token punctuation">&gt;</span></span> subList<span class="token punctuation">)</span>
          <span class="token punctuation">{</span>
              sum <span class="token operator">+=</span> <span class="token function">GetSum</span><span class="token punctuation">(</span>subList<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">return</span> sum<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用方法：</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code>  条件控制语句（obj <span class="token keyword">is</span> <span class="token class-name">type</span> variable）
   <span class="token punctuation">{</span>
      <span class="token comment">// Processing...</span>
   <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>理解析：此 is 非彼 is ，这个扩展的 is 其实是 as 和 if 的组合。即它先进行 as 转换再进行 if 判断，判断其结果是否为 null，不等于 null 则执行</p><p>语句块逻辑，反之不行。由上可知其实 C# 7 之前我们也可实现类似的功能，只是写法上比较繁琐。</p><p>3.2switch 语句更新（switch statement updates），如：</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">GetSum</span><span class="token punctuation">(</span><span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span><span class="token keyword">object</span><span class="token punctuation">&gt;</span></span> values<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
      <span class="token class-name"><span class="token keyword">var</span></span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>values <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>

      <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> item <span class="token keyword">in</span> values<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
          <span class="token keyword">switch</span> <span class="token punctuation">(</span>item<span class="token punctuation">)</span>
          <span class="token punctuation">{</span>
              <span class="token keyword">case</span> <span class="token number">0</span><span class="token punctuation">:</span>                <span class="token comment">// 常量模式匹配</span>
                  <span class="token keyword">break</span><span class="token punctuation">;</span>
              <span class="token keyword">case</span> <span class="token class-name"><span class="token keyword">short</span></span> sval<span class="token punctuation">:</span>       <span class="token comment">// 类型模式匹配</span>
                  sum <span class="token operator">+=</span> sval<span class="token punctuation">;</span>
                  <span class="token keyword">break</span><span class="token punctuation">;</span>
              <span class="token keyword">case</span> <span class="token class-name"><span class="token keyword">int</span></span> ival<span class="token punctuation">:</span>
                  sum <span class="token operator">+=</span> ival<span class="token punctuation">;</span>
                  <span class="token keyword">break</span><span class="token punctuation">;</span>
              <span class="token keyword">case</span> <span class="token class-name"><span class="token keyword">string</span></span> str <span class="token keyword">when</span> <span class="token keyword">int</span><span class="token punctuation">.</span><span class="token function">TryParse</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> <span class="token keyword">out</span> <span class="token class-name"><span class="token keyword">var</span></span> result<span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token comment">// 类型模式匹配 + 条件表达式</span>
                  sum <span class="token operator">+=</span> result<span class="token punctuation">;</span>
                  <span class="token keyword">break</span><span class="token punctuation">;</span>
              <span class="token keyword">case</span> <span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span><span class="token keyword">object</span><span class="token punctuation">&gt;</span></span> subList <span class="token keyword">when</span> subList<span class="token punctuation">.</span><span class="token function">Any</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                  sum <span class="token operator">+=</span> <span class="token function">GetSum</span><span class="token punctuation">(</span>subList<span class="token punctuation">)</span><span class="token punctuation">;</span>
                  <span class="token keyword">break</span><span class="token punctuation">;</span>
              <span class="token keyword">default</span><span class="token punctuation">:</span>
                  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">InvalidOperationException</span><span class="token punctuation">(</span><span class="token string">&quot;未知的类型&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">return</span> sum<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用方法：</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">switch</span> <span class="token punctuation">(</span>item<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token class-name">type</span> variable1<span class="token punctuation">:</span>
          <span class="token comment">// processing...</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token class-name">type</span> variable2 <span class="token keyword">when</span> predicate<span class="token punctuation">:</span>
          <span class="token comment">// processing...</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">default</span><span class="token punctuation">:</span>
          <span class="token comment">// processing...</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>原理解析：此 switch 非彼 switch，编译后你会发现扩展的 switch 就是 as 、if 、goto 语句的组合体。同 is expressions 一样，以前我们也能实</p><p>现只是写法比较繁琐并且可读性不强。</p><p>总结：模式匹配语法是想让我们在简单的情况下实现类似与多态一样的动态调用，即在运行时确定成员类型和调用具体的实现。</p><h3 id="_4-局部引用和引用返回-ref-locals-and-returns" tabindex="-1"><a class="header-anchor" href="#_4-局部引用和引用返回-ref-locals-and-returns" aria-hidden="true">#</a> 4. 局部引用和引用返回 (Ref locals and returns)</h3><p>我们知道 C# 的 ref 和 out 关键字是对值传递的一个补充，是为了防止值类型大对象在 Copy 过程中损失更多的性能。现在在 C# 7 中 ref 关键字得</p><p>到了加强，它不仅可以获取值类型的引用而且还可以获取某个变量（引用类型）的局部引用。如：</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">static</span> <span class="token keyword">ref</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">GetLocalRef</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token punctuation">]</span></span> arr<span class="token punctuation">,</span> <span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token punctuation">&gt;</span></span> func<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span><span class="token function">GetLength</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span><span class="token function">GetLength</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
          <span class="token punctuation">{</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">func</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
              <span class="token punctuation">{</span>
                  <span class="token keyword">return</span> <span class="token keyword">ref</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">InvalidOperationException</span><span class="token punctuation">(</span><span class="token string">&quot;Not found&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Call：</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code>   <span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token punctuation">]</span></span> arr <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">{</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">15</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">25</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
   <span class="token keyword">ref</span> <span class="token class-name"><span class="token keyword">var</span></span> num <span class="token operator">=</span> <span class="token keyword">ref</span> <span class="token function">GetLocalRef</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> c <span class="token operator">=&gt;</span> c <span class="token operator">==</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   num <span class="token operator">=</span> <span class="token number">600</span><span class="token punctuation">;</span>

  Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Print results： 600 使用方法：</p><ol><li><p>方法的返回值必须是引用返回：</p><p>a) 声明方法签名时必须在返回类型前加上 ref 修饰。</p><p>b) 在每个 return 关键字后也要加上 ref 修饰，以表明是返回引用。</p></li><li><p>分配引用（即赋值），必须在声明局部变量前加上 ref 修饰，以及在方法返回引用前加上 ref 修饰。</p></li></ol><p>注：C# 开发的是托管代码，所以一般不希望程序员去操作指针。并由上述可知在使用过程中需要大量的使用 ref 来标明这是引用变量（编译后其</p><p>实没那么多），当然这也是为了提高代码的可读性。</p><p>总结：虽然 C# 7 中提供了局部引用和引用返回，但为了防止滥用所以也有诸多约束，如：</p><ol><li>你不能将一个值分配给 ref 变量，如：</li></ol><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code>  <span class="token keyword">ref</span> <span class="token class-name"><span class="token keyword">int</span></span> num <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>   <span class="token comment">// error：无法使用值初始化按引用变量</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="2"><li>你不能返回一个生存期不超过方法作用域的变量引用，如：</li></ol><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code> <span class="token keyword">public</span> <span class="token keyword">ref</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">GetLocalRef</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> num<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">ref</span> num<span class="token punctuation">;</span>   <span class="token comment">// error: 无法按引用返回参数，因为它不是 ref 或 out 参数</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="3"><li>ref 不能修饰 “属性” 和 “索引器”。</li></ol><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code>   <span class="token class-name"><span class="token keyword">var</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">ref</span> <span class="token class-name"><span class="token keyword">var</span></span> n <span class="token operator">=</span> <span class="token keyword">ref</span> list<span class="token punctuation">.</span>Count<span class="token punctuation">;</span>  <span class="token comment">// error: 属性或索引器不能作为 out 或 ref 参数传递</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>原理解析：非常简单就是指针传递，并且个人觉得此语法的使用场景非常有限，都是用来处理大对象的，目的是减少 GC 提高性能。</p><h3 id="_5-局部函数-local-functions" tabindex="-1"><a class="header-anchor" href="#_5-局部函数-local-functions" aria-hidden="true">#</a> 5. 局部函数（Local functions）</h3><p>C# 7 中的一个功能“局部函数”，如下所示：</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">static</span> <span class="token return-type class-name">IEnumerable<span class="token punctuation">&lt;</span><span class="token keyword">char</span><span class="token punctuation">&gt;</span></span> <span class="token function">GetCharList</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> str<span class="token punctuation">)</span>
   <span class="token punctuation">{</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">IsNullOrWhiteSpace</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span>
           <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArgumentNullException</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token keyword">return</span> <span class="token function">GetList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token return-type class-name">IEnumerable<span class="token punctuation">&lt;</span><span class="token keyword">char</span><span class="token punctuation">&gt;</span></span> <span class="token function">GetList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token punctuation">{</span>
           <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> str<span class="token punctuation">.</span>Length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
           <span class="token punctuation">{</span>
               <span class="token keyword">yield</span> <span class="token keyword">return</span> str<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
       <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用方法：</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code>   <span class="token punctuation">[</span>数据类型<span class="token punctuation">,</span><span class="token keyword">void</span><span class="token punctuation">]</span> 方法名（<span class="token punctuation">[</span>参数<span class="token punctuation">]</span>）
  <span class="token punctuation">{</span>
      <span class="token comment">// Method body；[] 里面都是可选项</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>原理解析：局部函数虽然是在其他函数内部声明，但它编译后就是一个被 internal 修饰的静态函数，它是属于类，至于它为什么能够使用上级函</p><p>数中的局部变量和参数呢？那是因为编译器会根据其使用的成员生成一个新类型（Class/Struct）然后将其传入函数中。由上可知则局部函数的声</p><p>明跟位置无关，并可无限嵌套。</p><p>总结：个人觉得局部函数是对 C# 异常机制在语义上的一次补充（如上例），以及为代码提供清晰的结构而设置的语法。但局部函数也有其缺点，</p><p>就是局部函数中的代码无法复用（反射除外）。</p><h3 id="_6-更多的表达式体成员-more-expression-bodied-members" tabindex="-1"><a class="header-anchor" href="#_6-更多的表达式体成员-more-expression-bodied-members" aria-hidden="true">#</a> 6. 更多的表达式体成员（More expression-bodied members）</h3><p>C# 6 的时候就支持表达式体成员，但当时只支持“函数成员”和“只读属性”，这一特性在 C# 7 中得到了扩展，它能支持更多的成员：构造函数</p><p>、析构函数、带 get，set 访问器的属性、以及索引器。如下所示：</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Student</span>
  <span class="token punctuation">{</span>
      <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">string</span></span> _name<span class="token punctuation">;</span>

      <span class="token comment">// Expression-bodied constructor</span>
      <span class="token keyword">public</span> <span class="token function">Student</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> _name <span class="token operator">=</span> name<span class="token punctuation">;</span>

      <span class="token comment">// Expression-bodied finalizer</span>
      <span class="token operator">~</span><span class="token function">Student</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Finalized!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// Expression-bodied get / set accessors.</span>
      <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name
      <span class="token punctuation">{</span>
          <span class="token keyword">get</span> <span class="token operator">=&gt;</span> _name<span class="token punctuation">;</span>
          <span class="token keyword">set</span> <span class="token operator">=&gt;</span> _name <span class="token operator">=</span> <span class="token keyword">value</span> <span class="token operator">??</span> <span class="token string">&quot;Mike&quot;</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// Expression-bodied indexers</span>
      <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token keyword">this</span><span class="token punctuation">[</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">]</span> <span class="token operator">=&gt;</span> Convert<span class="token punctuation">.</span><span class="token function">ToBase64String</span><span class="token punctuation">(</span>Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">.</span><span class="token function">GetBytes</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>备注：索引器其实在 C# 6 中就得到了支持，但其它三种在 C# 6 中未得到支持。</p><h3 id="_7-throw-表达式-throw-expressions" tabindex="-1"><a class="header-anchor" href="#_7-throw-表达式-throw-expressions" aria-hidden="true">#</a> 7. Throw 表达式（Throw expressions）</h3><p>在 C#7.0 以前,我们想判断一个字符串是否为 null,如果为 null 则抛除异常,我们需要这么写:</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">IsNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">string</span></span> a <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Exception</span><span class="token punctuation">(</span><span class="token string">&quot;异常了!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">return</span> a<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>样,我们就很不方便,特别是在三元表达式 或者非空表达式中,都无法抛除这个异常,需要写 if 语句.</p><p>那么我们在 C#7.0 中,可以这样:</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">IsNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">string</span></span> a <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token keyword">return</span> a <span class="token operator">??</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Exception</span><span class="token punctuation">(</span><span class="token string">&quot;异常了!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-扩展异步返回类型-generalized-async-return-types" tabindex="-1"><a class="header-anchor" href="#_8-扩展异步返回类型-generalized-async-return-types" aria-hidden="true">#</a> 8. 扩展异步返回类型（Generalized async return types）</h3><p>以前异步的返回类型必须是：<code>Task</code>、<code>Task&lt;T&gt;</code>、<code>void</code>，现在 C# 7 中新增了一种类型：<code>ValueTask&lt;T&gt;</code>，如下所示：</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code>   <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">ValueTask<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span> <span class="token function">Func</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token punctuation">{</span>
       <span class="token keyword">await</span> Task<span class="token punctuation">.</span><span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token number">100</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>总结：<code>ValueTask&lt;T&gt;</code> 与 <code>ValueTuple</code> 非常相似，所以就不列举： <code>ValueTask&lt;T&gt;</code> 与 <code>Task</code> 之间的异同了，但它们都是为了优化特定场景性能而</p><p>新增的类型。</p><p>使用 <code>ValueTask&lt;T&gt;</code> 则需要导入： Install - Package System.Threading.Tasks.Extensions</p><h3 id="_9-数字文本语法的改进-numeric-literal-syntax-improvements" tabindex="-1"><a class="header-anchor" href="#_9-数字文本语法的改进-numeric-literal-syntax-improvements" aria-hidden="true">#</a> 9. 数字文本语法的改进（Numeric literal syntax improvements）</h3><p>C# 7 还包含两个新特性：二进制文字、数字分隔符，如下所示：</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code>  <span class="token class-name"><span class="token keyword">var</span></span> one <span class="token operator">=</span> <span class="token number">0b0001</span><span class="token punctuation">;</span>
  <span class="token class-name"><span class="token keyword">var</span></span> sixteen <span class="token operator">=</span> <span class="token number">0b0001_0000</span><span class="token punctuation">;</span>
  <span class="token class-name"><span class="token keyword">long</span></span> salary <span class="token operator">=</span> <span class="token number">1000_000_000</span><span class="token punctuation">;</span>
  <span class="token class-name"><span class="token keyword">decimal</span></span> pi <span class="token operator">=</span> <span class="token number">3.141_592_653_589m</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注：二进制文本是以 0b（零 b）开头，字母不区分大小写；数字分隔符只有三个地方不能写：开头，结尾，小数点前后。</p><p>总结：二进制文本，数字分隔符 可使常量值更具可读性。</p></div><!--[--><!--]--></div><footer class="page-meta"><!----><!----><!----></footer><nav class="page-nav"><p class="inner"><!----><span class="next"><a href="/code/dotnet/CSharpNewFeatures/8.0/" class="" aria-label="8.0"><!--[--><!--]--> 8.0 <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.d8de21cf.js" defer></script>
  </body>
</html>
