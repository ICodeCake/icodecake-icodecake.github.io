<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.51">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/images/logo.png"><title>Code Cake</title><meta name="description" content="代码分享">
    <link rel="modulepreload" href="/assets/app.a9bc884a.js"><link rel="modulepreload" href="/assets/index.html.6a0ae96a.js"><link rel="modulepreload" href="/assets/index.html.1cf9b97a.js"><link rel="prefetch" href="/assets/index.html.b5b50aed.js"><link rel="prefetch" href="/assets/index.html.82c10bf5.js"><link rel="prefetch" href="/assets/markdown.html.373131ab.js"><link rel="prefetch" href="/assets/index.html.0f8400b2.js"><link rel="prefetch" href="/assets/index.html.5187c5a6.js"><link rel="prefetch" href="/assets/index.html.d5708d20.js"><link rel="prefetch" href="/assets/index.html.e801a3c2.js"><link rel="prefetch" href="/assets/index.html.093bbf26.js"><link rel="prefetch" href="/assets/index.html.7133a7ec.js"><link rel="prefetch" href="/assets/CodeReadability.html.e0c8ecb4.js"><link rel="prefetch" href="/assets/CodeReview.html.148be5a3.js"><link rel="prefetch" href="/assets/CSharpCodingStyle.html.db2bbb9b.js"><link rel="prefetch" href="/assets/index.html.10e573d6.js"><link rel="prefetch" href="/assets/UnitTesting.html.448518f1.js"><link rel="prefetch" href="/assets/index.html.64bac6cb.js"><link rel="prefetch" href="/assets/index.html.7730f91b.js"><link rel="prefetch" href="/assets/index.html.197fa484.js"><link rel="prefetch" href="/assets/index.html.19d60b55.js"><link rel="prefetch" href="/assets/index.html.e0b02fac.js"><link rel="prefetch" href="/assets/index.html.b836efc4.js"><link rel="prefetch" href="/assets/index.html.c828d055.js"><link rel="prefetch" href="/assets/index.html.8b0be331.js"><link rel="prefetch" href="/assets/index.html.42e40658.js"><link rel="prefetch" href="/assets/index.html.afd1fb01.js"><link rel="prefetch" href="/assets/index.html.0c10a718.js"><link rel="prefetch" href="/assets/index.html.033b940a.js"><link rel="prefetch" href="/assets/index.html.6783e956.js"><link rel="prefetch" href="/assets/Built-inTypesAndMethods.html.6a6bb314.js"><link rel="prefetch" href="/assets/index.html.d00e9e45.js"><link rel="prefetch" href="/assets/index.html.7579bb0e.js"><link rel="prefetch" href="/assets/index.html.d9366227.js"><link rel="prefetch" href="/assets/index.html.368c0ad8.js"><link rel="prefetch" href="/assets/index.html.10f6513e.js"><link rel="prefetch" href="/assets/index.html.c1838371.js"><link rel="prefetch" href="/assets/index.html.ce3db78c.js"><link rel="prefetch" href="/assets/index.html.646a657a.js"><link rel="prefetch" href="/assets/index.html.96e3e11a.js"><link rel="prefetch" href="/assets/index.html.44d24fc0.js"><link rel="prefetch" href="/assets/index.html.5860f8d9.js"><link rel="prefetch" href="/assets/index.html.0cd4c1be.js"><link rel="prefetch" href="/assets/index.html.ae3ec48d.js"><link rel="prefetch" href="/assets/index.html.7bff8c2c.js"><link rel="prefetch" href="/assets/index.html.7b1c920b.js"><link rel="prefetch" href="/assets/index.html.8e18a882.js"><link rel="prefetch" href="/assets/index.html.8cf1ea5a.js"><link rel="prefetch" href="/assets/index.html.aa4d6c47.js"><link rel="prefetch" href="/assets/index.html.1d466d5f.js"><link rel="prefetch" href="/assets/index.html.66288271.js"><link rel="prefetch" href="/assets/index.html.da9590d3.js"><link rel="prefetch" href="/assets/index.html.6ba2983a.js"><link rel="prefetch" href="/assets/index.html.6b7f34ab.js"><link rel="prefetch" href="/assets/index.html.2efe1c06.js"><link rel="prefetch" href="/assets/index.html.6816dcdc.js"><link rel="prefetch" href="/assets/index.html.cacc9c2e.js"><link rel="prefetch" href="/assets/index.html.b29383df.js"><link rel="prefetch" href="/assets/index.html.977ade2f.js"><link rel="prefetch" href="/assets/index.html.fd4d7ec5.js"><link rel="prefetch" href="/assets/404.html.d8035c30.js"><link rel="prefetch" href="/assets/index.html.1c3e24dd.js"><link rel="prefetch" href="/assets/index.html.eedf2c5d.js"><link rel="prefetch" href="/assets/markdown.html.4165b774.js"><link rel="prefetch" href="/assets/index.html.0de199aa.js"><link rel="prefetch" href="/assets/index.html.b54d259b.js"><link rel="prefetch" href="/assets/index.html.146f86e0.js"><link rel="prefetch" href="/assets/index.html.b5a1f2f0.js"><link rel="prefetch" href="/assets/index.html.387b7146.js"><link rel="prefetch" href="/assets/index.html.c7652f4d.js"><link rel="prefetch" href="/assets/CodeReadability.html.1aabb46d.js"><link rel="prefetch" href="/assets/CodeReview.html.5bcc234f.js"><link rel="prefetch" href="/assets/CSharpCodingStyle.html.2510e4fd.js"><link rel="prefetch" href="/assets/index.html.32cf1a58.js"><link rel="prefetch" href="/assets/UnitTesting.html.22f3889d.js"><link rel="prefetch" href="/assets/index.html.f84e1b9e.js"><link rel="prefetch" href="/assets/index.html.fcdf8763.js"><link rel="prefetch" href="/assets/index.html.5650ed88.js"><link rel="prefetch" href="/assets/index.html.0f4b85e7.js"><link rel="prefetch" href="/assets/index.html.dcbd44de.js"><link rel="prefetch" href="/assets/index.html.c699940c.js"><link rel="prefetch" href="/assets/index.html.b93ad119.js"><link rel="prefetch" href="/assets/index.html.fee3ec0a.js"><link rel="prefetch" href="/assets/index.html.abd54384.js"><link rel="prefetch" href="/assets/index.html.d590eb1b.js"><link rel="prefetch" href="/assets/index.html.d0d99d8d.js"><link rel="prefetch" href="/assets/index.html.8608c205.js"><link rel="prefetch" href="/assets/index.html.d245ff26.js"><link rel="prefetch" href="/assets/Built-inTypesAndMethods.html.53e2e900.js"><link rel="prefetch" href="/assets/index.html.4aee67ef.js"><link rel="prefetch" href="/assets/index.html.05969f72.js"><link rel="prefetch" href="/assets/index.html.24941b3f.js"><link rel="prefetch" href="/assets/index.html.cab860bf.js"><link rel="prefetch" href="/assets/index.html.31bbc0d1.js"><link rel="prefetch" href="/assets/index.html.78ecd2e6.js"><link rel="prefetch" href="/assets/index.html.e1109234.js"><link rel="prefetch" href="/assets/index.html.dfed5d73.js"><link rel="prefetch" href="/assets/index.html.0b5da4fd.js"><link rel="prefetch" href="/assets/index.html.11e5ffa4.js"><link rel="prefetch" href="/assets/index.html.8607d767.js"><link rel="prefetch" href="/assets/index.html.3195fd2b.js"><link rel="prefetch" href="/assets/index.html.52338eb1.js"><link rel="prefetch" href="/assets/index.html.d4dc0f7c.js"><link rel="prefetch" href="/assets/index.html.7b9db3f6.js"><link rel="prefetch" href="/assets/index.html.72cad667.js"><link rel="prefetch" href="/assets/index.html.6eaa6af1.js"><link rel="prefetch" href="/assets/index.html.7f154139.js"><link rel="prefetch" href="/assets/index.html.c67d14d4.js"><link rel="prefetch" href="/assets/index.html.89fbd8e6.js"><link rel="prefetch" href="/assets/index.html.ce4be880.js"><link rel="prefetch" href="/assets/index.html.8b47442e.js"><link rel="prefetch" href="/assets/index.html.967b18d1.js"><link rel="prefetch" href="/assets/index.html.6fc435d5.js"><link rel="prefetch" href="/assets/index.html.6f76a9a4.js"><link rel="prefetch" href="/assets/index.html.f71efea1.js"><link rel="prefetch" href="/assets/index.html.19d7b071.js"><link rel="prefetch" href="/assets/index.html.3f5fef5d.js"><link rel="prefetch" href="/assets/index.html.515a97f1.js"><link rel="prefetch" href="/assets/404.html.03408f29.js">
    <link rel="stylesheet" href="/assets/style.f35a7668.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><img class="logo" src="/images/logo.png" alt="Code Cake"><span class="site-name can-hide">Code Cake</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/code/dotnet/" class="router-link-active" aria-label=".NET"><!--[--><!--]--> .NET <!--[--><!--]--></a></div><div class="navbar-item"><a href="/code/web/" class="" aria-label="WEB"><!--[--><!--]--> WEB <!--[--><!--]--></a></div><div class="navbar-item"><a href="/code/database/" class="" aria-label="Database"><!--[--><!--]--> Database <!--[--><!--]--></a></div><div class="navbar-item"><a href="/code/test/" class="" aria-label="Test"><!--[--><!--]--> Test <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/icodecake/icodecake.github.io" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" placeholder="搜索" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/code/dotnet/" class="router-link-active" aria-label=".NET"><!--[--><!--]--> .NET <!--[--><!--]--></a></div><div class="navbar-item"><a href="/code/web/" class="" aria-label="WEB"><!--[--><!--]--> WEB <!--[--><!--]--></a></div><div class="navbar-item"><a href="/code/database/" class="" aria-label="Database"><!--[--><!--]--> Database <!--[--><!--]--></a></div><div class="navbar-item"><a href="/code/test/" class="" aria-label="Test"><!--[--><!--]--> Test <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/icodecake/icodecake.github.io" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">WPF <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/code/dotnet/WpfUILayout" class="sidebar-item" aria-label="WPF UI Layout"><!--[--><!--]--> WPF UI Layout <!--[--><!--]--></a><!----></li><li><a href="/code/dotnet/XAMLBinding" class="sidebar-item" aria-label="XAML Binding"><!--[--><!--]--> XAML Binding <!--[--><!--]--></a><!----></li><li><a href="/code/dotnet/Language" class="sidebar-item" aria-label="WPF 本地化"><!--[--><!--]--> WPF 本地化 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">C# <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><p tabindex="0" class="sidebar-item">新特性 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/code/dotnet/CSharpNewFeatures/7.0/" class="sidebar-item" aria-label="7.0"><!--[--><!--]--> 7.0 <!--[--><!--]--></a><!----></li><li><a href="/code/dotnet/CSharpNewFeatures/8.0/" class="sidebar-item" aria-label="8.0"><!--[--><!--]--> 8.0 <!--[--><!--]--></a><!----></li><li><a href="/code/dotnet/CSharpNewFeatures/9.0/" class="sidebar-item" aria-label="9.0"><!--[--><!--]--> 9.0 <!--[--><!--]--></a><!----></li><li><a href="/code/dotnet/CSharpNewFeatures/10.0/" class="sidebar-item" aria-label="10.0"><!--[--><!--]--> 10.0 <!--[--><!--]--></a><!----></li><li><a href="/code/dotnet/CSharpNewFeatures/11.0/" class="sidebar-item" aria-label="11.0"><!--[--><!--]--> 11.0 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item">多线程 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/code/dotnet/Multithreading/BackgroundWorker/" class="sidebar-item" aria-label="BackgroundWorker"><!--[--><!--]--> BackgroundWorker <!--[--><!--]--></a><!----></li><li><a href="/code/dotnet/Multithreading/ThreadAndTask/" class="sidebar-item" aria-label="Thread and Task"><!--[--><!--]--> Thread and Task <!--[--><!--]--></a><!----></li><li><a href="/code/dotnet/Multithreading/Parallel/" class="sidebar-item" aria-label="Parallel"><!--[--><!--]--> Parallel <!--[--><!--]--></a><!----></li><li><a href="/code/dotnet/Multithreading/AsyncAndAwait/" class="sidebar-item" aria-label="Async and Await"><!--[--><!--]--> Async and Await <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item">Json <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/code/dotnet/Json/" class="sidebar-item" aria-label="System.Text.Json"><!--[--><!--]--> System.Text.Json <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item">Log <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/code/dotnet/Log4Net/" class="sidebar-item" aria-label="Log4Net"><!--[--><!--]--> Log4Net <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/code/dotnet/Net5Publish/" class="sidebar-item" aria-label="VS2019 基于.NET5 单文件打包"><!--[--><!--]--> VS2019 基于.NET5 单文件打包 <!--[--><!--]--></a><!----></li><li><a href="/code/dotnet/DynamicMeanNumber/" class="sidebar-item" aria-label="无缓存计算平均数"><!--[--><!--]--> 无缓存计算平均数 <!--[--><!--]--></a><!----></li><li><a href="/code/dotnet/VideoCompression/" class="sidebar-item" aria-label="视频压缩"><!--[--><!--]--> 视频压缩 <!--[--><!--]--></a><!----></li><li><a href="/code/dotnet/Speech/" class="sidebar-item" aria-label="语音识别"><!--[--><!--]--> 语音识别 <!--[--><!--]--></a><!----></li><li><a href="/code/dotnet/HttpContext/" class="sidebar-item" aria-label="HttpContext.Items vs HttpContext.Features"><!--[--><!--]--> HttpContext.Items vs HttpContext.Features <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Other <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/code/dotnet/InvalidFileName" class="sidebar-item" aria-label="Win10 aux,com1~com9,prn,con,nul文件命名无效"><!--[--><!--]--> Win10 aux,com1~com9,prn,con,nul文件命名无效 <!--[--><!--]--></a><!----></li><li><a href="/code/dotnet/matlab" class="sidebar-item" aria-label="C#调用Matlab函数"><!--[--><!--]--> C#调用Matlab函数 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h2 id="中间件" tabindex="-1"><a class="header-anchor" href="#中间件" aria-hidden="true">#</a> 中间件</h2><h3 id="什么是中间件" tabindex="-1"><a class="header-anchor" href="#什么是中间件" aria-hidden="true">#</a> 什么是中间件？</h3><blockquote><p>在 ASP.NET Core 中，中间件是一个可以处理 HTTP 请求或响应的软件管道。在 ASP.NET Core 中，中间件具有非常特定的用途。比如，我们可能需要一个中间件验证用户，一个中间件处理错误，一个中间件来提供静态文件，如 Javascript 文件、CSS 文件和图片等。 我们在 ASP.NET Core 中使用这些中间件设置请求处理管道，正是这管道决定了如何处理请求。而请求处理管道是由 Startup.cs 文件中的 Configure()方法进行配置的，它也是应用程序启动的一个重要部分。</p></blockquote><h2 id="中间件顺序" tabindex="-1"><a class="header-anchor" href="#中间件顺序" aria-hidden="true">#</a> 中间件顺序</h2><p><img src="/assets/01.34556864.png" alt="图片"> 中间件可以同时处理传入请求和传出响应。因此，中间件可以处理传入请求并将该请求传递给管道中的下一个中间件以进行下一步处理。 Program.cs 中的以下突出显示的代码按照典型的建议顺序增加与安全相关的中间件组件：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>        var app = context.GetApplicationBuilder();
        var env = context.GetEnvironment();

        if (env.IsDevelopment())
        {
            app.UseDeveloperExceptionPage();
        }

        app.UseAbpRequestLocalization();
        app.UseCorrelationId();
        app.UseStaticFiles();
        app.UseRouting();
        app.UseCors();
        app.UseAuthentication();

        if (MultiTenancyConsts.IsEnabled)
        {
            app.UseMultiTenancy();
        }

        app.UseAuthorization();

        app.UseSignalRJwtToken();

        app.UseSwagger();
        app.UseAbpSwaggerUI(options =&gt;
        {
            //options.SwaggerEndpoint(&quot;/swagger/v1/swagger.json&quot;, &quot;PsyLAB API&quot;);

            SwaggerConsts.ApiInfos.ForEach(x =&gt;
            {
                options.SwaggerEndpoint($&quot;/swagger/{x.UrlPrefix}/swagger.json&quot;, x.Name);
            });
            // 模型的默认扩展深度，设置为 -1 完全隐藏模型
            options.DefaultModelsExpandDepth(-1);
            // API文档仅展开标记
            options.DocExpansion(DocExpansion.List);
            // API前缀设置为空
            //options.RoutePrefix = string.Empty;
            // API页面Title
            options.DocumentTitle = &quot;接口文档 - SPSI&quot;;

            //options.SwaggerEndpoint(&quot;/swagger/v1/swagger.json&quot;, &quot;Support APP API&quot;);
            var configuration = context.GetConfiguration();
            options.OAuthClientId(configuration[&quot;AuthServer:SwaggerClientId&quot;]);
            options.OAuthClientSecret(configuration[&quot;AuthServer:SwaggerClientSecret&quot;]);
        });

        app.UseAuditing();
        app.UseAbpSerilogEnrichers();
        app.UseUnitOfWork();
        app.UseConfiguredEndpoints();
        app.Use((httpContext, next) =&gt;
        {
            httpContext.Request.Scheme = &quot;http&quot;;
            return next();
        });
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>并非所有中间件都完全按照此顺序出现，但许多中间件都会遵循此顺序。 例如：</li></ul><ol><li>UseCors、UseAuthentication 和 UseAuthorization 必须按显示的顺序出现。</li><li>UseCors 当前必须在 UseResponseCaching 之前出现。 <a href="https://github.com/dotnet/aspnetcore/issues/23218" target="_blank" rel="noopener noreferrer">详细说明<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li>UseRequestLocalization 必须在可能检查请求区域性的任何中间件（例如 app.UseMvcWithDefaultRoute()）之前出现。 在某些场景下，中间件的排序有所不同。 例如，高速缓存和压缩排序是特定于场景的，存在多个有效的排序。 例如：</li></ol><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>app.UseResponseCaching();
app.UseResponseCompression();
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>使用以上的代码，可以通过缓存压缩的响应来减少 CPU 使用量，但可能最终会使用不同的压缩算法（如 Gzip 或 Brotli）来缓存资源的多个表示形式。 以下 Program.cs 代码将为常见应用场景添加中间件组件：</p><ol><li>异常/错误处理 <ul><li>当应用在开发环境中运行时： <ul><li>开发人员异常页中间件 (UseDeveloperExceptionPage) 报告应用运行时错误。</li><li>数据库错误页中间件 (UseDatabaseErrorPage) 报告数据库运行时错误。</li></ul></li><li>当应用在生产环境中运行时： <ul><li>异常处理程序中间件 (UseExceptionHandler) 捕获以下中间件中引发的异常。</li><li>HTTP 严格传输安全协议 (HSTS) 中间件 (UseHsts) 添加 Strict-Transport-Security 标头。</li></ul></li></ul></li><li>HTTPS 重定向中间件 (UseHttpsRedirection) 将 HTTP 请求重定向到 HTTPS。</li><li>静态文件中间件 (UseStaticFiles) 返回静态文件，并简化进一步请求处理。</li><li>Cookie 策略中间件 (UseCookiePolicy) 使应用符合欧盟一般数据保护条例 (GDPR) 规定。</li><li>用于路由请求的路由中间件 (UseRouting)。</li><li>身份验证中间件 (UseAuthentication) 尝试对用户进行身份验证，然后才会允许用户访问安全资源。</li><li>用于授权用户访问安全资源的授权中间件 (UseAuthorization)。</li><li>会话中间件 (UseSession) 建立和维护会话状态。 如果应用使用会话状态，请在 Cookie 策略中间件之后和 MVC 中间件之前调用会话中间件。</li><li>用于将 Razor Pages 终结点添加到请求管道的终结点路由中间件（带有 MapRazorPages 的 UseEndpoints）。</li></ol><h3 id="中间件特点" tabindex="-1"><a class="header-anchor" href="#中间件特点" aria-hidden="true">#</a> 中间件特点</h3><ul><li>可同时被访问和请求</li><li>可以处理请求，然后将请求传递给下一个中间件</li><li>可以处理请求，并使管道短路</li><li>可以处理传出响应</li><li>中间件是按照添加的顺序执行的。</li></ul><h3 id="中间件的工作流程" tabindex="-1"><a class="header-anchor" href="#中间件的工作流程" aria-hidden="true">#</a> 中间件的工作流程</h3><p><img src="/assets/02.24e05f62.png" alt="图片"> 结果： <img src="data:image/png;base64,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" alt="图片"> 流程图 <img src="/assets/04.87480d12.png" alt="图片"></p><ul><li>所有的请求都会在每个中间件调用 next()方法之前触发。请求按照一定方向依次穿过所有管道</li><li>当中间件处理请求并产生响应时，请求处理流程在管道中开始反向传递</li><li>所有的响应都会在每个中间件调用 next()方法之前触发。响应按一定方向依次穿过所有管道。</li></ul></div><!--[--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">上次更新: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">贡献者: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: ryning@sina.com">Z小染</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.a9bc884a.js" defer></script>
  </body>
</html>
